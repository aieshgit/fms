{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/akau1902/Web Development/fleet-management-system/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/akau1902/Web Development/fleet-management-system/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/akau1902/Web Development/fleet-management-system/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useEffect,useState,useContext}from\"react\";import axios from\"axios\";import{LoginContext}from\"../context/Context.js\";import{useHistory}from\"react-router-dom\";//import { SyncOutlined } from \"@nt-design/icons\";\nimport{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";var UserAuth=function UserAuth(_ref){var children=_ref.children;var history=useHistory();var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isUserAuth=_useState2[0],setUserAuth=_useState2[1];var _useContext=useContext(LoginContext),_useContext2=_slicedToArray(_useContext,2),loginState=_useContext2[0],setLoginState=_useContext2[1];useEffect(function(){// if (loginState && loginState.token) {\ncheckUserAuth();//  }\n//}, [loginState && loginState.token]);\n},[]);var checkUserAuth=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$axios$get,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return axios.get(\"\".concat(process.env.REACT_APP_BACKEND_SERVER,\"/user-auth\"),{// headers: { Authorization: `Bearer ${loginState.token}` },\nheaders:{authorization:\"Bearer \".concat(JSON.parse(window.localStorage.getItem(\"auth\")).token)}});case 3:_yield$axios$get=_context.sent;data=_yield$axios$get.data;if(data.ok){setUserAuth(true);}_context.next=11;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](0);history.push(\"/login\");case 11:case\"end\":return _context.stop();}}},_callee,null,[[0,8]]);}));return function checkUserAuth(){return _ref2.apply(this,arguments);};}();// return !isUserAuth ? (<SyncOutLined spin className= \"d-flex justify-content-center display-1 text-primary p-5/>\")\n//return !isUserAuth ? false : [children];\nreturn!isUserAuth?false:/*#__PURE__*/_jsx(_Fragment,{children:children});};export default UserAuth;","map":{"version":3,"sources":["C:/Users/akau1902/Web Development/fleet-management-system/client/src/components/auth/UserAuth.js"],"names":["useEffect","useState","useContext","axios","LoginContext","useHistory","UserAuth","children","history","isUserAuth","setUserAuth","loginState","setLoginState","checkUserAuth","get","process","env","REACT_APP_BACKEND_SERVER","headers","authorization","JSON","parse","window","localStorage","getItem","token","data","ok","push"],"mappings":"kiBAAA,OAASA,SAAT,CAAoBC,QAApB,CAA8BC,UAA9B,KAAgD,OAAhD,CACA,MAAOC,CAAAA,KAAP,KAAkB,OAAlB,CACA,OAASC,YAAT,KAA6B,uBAA7B,CACA,OAASC,UAAT,KAA2B,kBAA3B,CACA;gGAEA,GAAMC,CAAAA,QAAQ,CAAG,QAAXA,CAAAA,QAAW,MAAkB,IAAfC,CAAAA,QAAe,MAAfA,QAAe,CACjC,GAAIC,CAAAA,OAAO,CAAGH,UAAU,EAAxB,CACA,cAAkCJ,QAAQ,CAAC,KAAD,CAA1C,wCAAOQ,UAAP,eAAmBC,WAAnB,eACA,gBAAoCR,UAAU,CAACE,YAAD,CAA9C,4CAAOO,UAAP,iBAAmBC,aAAnB,iBAEAZ,SAAS,CAAC,UAAM,CACd;AACAa,aAAa,GACb;AACA;AACD,CALQ,CAKN,EALM,CAAT,CAOA,GAAMA,CAAAA,aAAa,2FAAG,mMAKKV,CAAAA,KAAK,CAACW,GAAN,WAClBC,OAAO,CAACC,GAAR,CAAYC,wBADM,eAErB,CACE;AACAC,OAAO,CAAE,CACPC,aAAa,kBACXC,IAAI,CAACC,KAAL,CAAWC,MAAM,CAACC,YAAP,CAAoBC,OAApB,CAA4B,MAA5B,CAAX,EAAgDC,KADrC,CADN,CAFX,CAFqB,CALL,uCAKVC,IALU,kBAKVA,IALU,CAiBlB,GAAIA,IAAI,CAACC,EAAT,CAAa,CACXjB,WAAW,CAAC,IAAD,CAAX,CACD,CAnBiB,+EAqBlBF,OAAO,CAACoB,IAAR,CAAa,QAAb,EArBkB,oEAAH,kBAAbf,CAAAA,aAAa,2CAAnB,CAwBA;AACA;AACA,MAAO,CAACJ,UAAD,CAAc,KAAd,cAAsB,yBAAGF,QAAH,EAA7B,CACD,CAvCD,CAyCA,cAAeD,CAAAA,QAAf","sourcesContent":["import { useEffect, useState, useContext } from \"react\";\r\nimport axios from \"axios\";\r\nimport { LoginContext } from \"../context/Context.js\";\r\nimport { useHistory } from \"react-router-dom\";\r\n//import { SyncOutlined } from \"@nt-design/icons\";\r\n\r\nconst UserAuth = ({ children }) => {\r\n  let history = useHistory();\r\n  const [isUserAuth, setUserAuth] = useState(false);\r\n  const [loginState, setLoginState] = useContext(LoginContext);\r\n\r\n  useEffect(() => {\r\n    // if (loginState && loginState.token) {\r\n    checkUserAuth();\r\n    //  }\r\n    //}, [loginState && loginState.token]);\r\n  }, []);\r\n\r\n  const checkUserAuth = async () => {\r\n    try {\r\n      // console.log(\"hello there\");\r\n      //  console.log(\"checkUserAuthToken 1: \" + loginState.token);\r\n      //let varLocalStorage = JSON.parse(window.localStorage.getItem(\"auth\"));\r\n      const { data } = await axios.get(\r\n        `${process.env.REACT_APP_BACKEND_SERVER}/user-auth`,\r\n        {\r\n          // headers: { Authorization: `Bearer ${loginState.token}` },\r\n          headers: {\r\n            authorization: `Bearer ${\r\n              JSON.parse(window.localStorage.getItem(\"auth\")).token\r\n            }`,\r\n          },\r\n        }\r\n      );\r\n\r\n      if (data.ok) {\r\n        setUserAuth(true);\r\n      }\r\n    } catch (err) {\r\n      history.push(\"/login\");\r\n    }\r\n  };\r\n  // return !isUserAuth ? (<SyncOutLined spin className= \"d-flex justify-content-center display-1 text-primary p-5/>\")\r\n  //return !isUserAuth ? false : [children];\r\n  return !isUserAuth ? false : <>{children}</>;\r\n};\r\n\r\nexport default UserAuth;\r\n"]},"metadata":{},"sourceType":"module"}